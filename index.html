<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Daily Pi Mart - Pi Network Marketplace</title>

    <meta
      name="description"
      content="Daily Pi Mart is a Pi Network marketplace where users can buy and sell goods using Pi cryptocurrency."
    />
    <meta name="author" content="Daily Pi Mart" />

    <!-- Open Graph -->
    <meta property="og:title" content="Daily Pi Mart - Pi Network Marketplace" />
    <meta
      property="og:description"
      content="Buy and sell on Daily Pi Mart using Pi cryptocurrency."
    />
    <meta property="og:type" content="website" />

    <style>
      /* Pi Browser warning banner */
      #pi-browser-banner {
        display: none;
        position: sticky;
        top: 0;
        z-index: 9999;
        padding: 12px 16px;
        background: #fee2e2;
        color: #7f1d1d;
        border-bottom: 1px solid #fecaca;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial,
          sans-serif;
      }

      #pi-browser-banner a {
        color: #065f46;
        font-weight: 600;
        text-decoration: underline;
      }

      #pi-sdk-error {
        display: none;
        margin: 12px;
        padding: 12px;
        background: #fff7ed;
        color: #7c2d12;
        border: 1px solid #fed7aa;
        border-radius: 8px;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial,
          sans-serif;
      }
    </style>
  </head>

  <body>
    <!-- Shown only when NOT inside Pi Browser -->
    <div id="pi-browser-banner">
      Payments are only available in the <strong>Pi Browser</strong>.
      <a href="pi://www.dailypimart.store">Open in Pi Browser</a>
    </div>

    <div id="pi-sdk-error">
      Failed to load Pi SDK. Please check your connection and reload.
    </div>

    <div id="root"></div>

    <!-- Pi SDK (must load BEFORE app code) -->
    <script
      src="https://sdk.minepi.com/pi-sdk.js"
      onerror="document.getElementById('pi-sdk-error').style.display='block';"
    ></script>

    <script>
      (function () {
        const isPiProtocol = window.location.protocol === "pi:";
        const inPiBrowser = !!window.Pi || isPiProtocol;

        // Show banner if not in Pi Browser
        if (!inPiBrowser) {
          const banner = document.getElementById("pi-browser-banner");
          banner.style.display = "block";
        }

        // Initialize Pi SDK safely
        function initPi() {
          if (!window.Pi || typeof window.Pi.init !== "function") {
            return false;
          }

          try {
            window.Pi.init({
              version: "2.0",
              sandbox: !isPiProtocol, // sandbox outside pi://
            });

            window.__PI_READY__ = true;
            document.dispatchEvent(
              new CustomEvent("pi-ready", {
                detail: { sandbox: !isPiProtocol },
              })
            );
            return true;
          } catch (e) {
            console.warn("Pi.init failed:", e);
            return false;
          }
        }

        // Retry a few times until SDK is ready
        let attempts = 0;
        const MAX_ATTEMPTS = 20;

        const interval = setInterval(() => {
          attempts++;
          if (initPi() || attempts >= MAX_ATTEMPTS) {
            clearInterval(interval);
          }
        }, 500);
      })();
    </script>

    <!-- App bundle -->
    <script type="module" src="/src/main.tsx"></script>

    <noscript>
      This app requires JavaScript and the Pi Browser.
      <a href="pi://www.dailypimart.store">Open in Pi Browser</a>
    </noscript>
  </body>
</html>
